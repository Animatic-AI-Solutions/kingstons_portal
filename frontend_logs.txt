 🔄 [ACTIVITIES UPDATED] onActivitiesUpdated callback triggered {affectedFundIds: undefined}
 📊 [ACTIVITIES UPDATED] Triggering portfolio IRR recalculation...
 🚀 [PORTFOLIO IRR] triggerPortfolioIRRRecalculation CALLED
 ✅ [PORTFOLIO IRR] Starting calculation for portfolio 291
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 📋 [PORTFOLIO IRR] Active holdings count: 2 (2) [{…}, {…}]
 💵 [PORTFOLIO IRR] Excluding Cash fund: Cash (ID: 1398)
 📊 [PORTFOLIO IRR] Portfolio IRR Calculation Summary:
    - Total active holdings: 2
    - Cash funds excluded: 1
    - Non-Cash funds to include: 1
    - Fund IDs: [1399]
 🔄 [PORTFOLIO IRR] Calling calculateStandardizedMultipleFundsIRR with 1 funds...
 ✅ [PORTFOLIO IRR] Calculation successful! {success: true, irr_percentage: 104.5, irr_decimal: 1.0453753561106156, calculation_date: '2025-02-01', portfolio_fund_ids: Array(1), …}
 ✅ [ACTIVITIES UPDATED] Portfolio IRR recalculation complete
 🔄 [ACTIVITIES UPDATED] Refreshing data...
 ✅ [ACTIVITIES UPDATED] Data refresh complete
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 ProductIRRCalculation: Starting optimized data fetch for account ID: 278
 ProductIRRCalculation: Account/product data received: {id: 278, client_id: 28, product_name: 'Z. TEST INACTIVE IRR BUG', product_type: 'ISA', status: 'active', …}
 ProductIRRCalculation: Using portfolio ID: 291
 ProductIRRCalculation: Fetching complete portfolio data with new optimized endpoint
 ProductIRRCalculation: Complete portfolio data received: {portfolio: {…}, template_info: null, portfolio_funds: Array(2), valuations_map: {…}, irr_map: {…}}
 ProductIRRCalculation: Complete activity logs received: {activity_logs: Array(1), summary: {…}}
 Filtering inactive holdings from: 2 holdings
 All holdings status values: (2) [{…}, {…}]
 Holding ID 1398 (Cash): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Holding ID 1399 (Artemis Income): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Found inactive holdings: []
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 🔍 Valuation Date Detection Debug: {totalHoldings: 2, allActiveHoldings: 2, activeHoldingsExcludingCash: 1, excludedCashFunds: 1, holdingsData: Array(1)}
 🔍 All unique valuation dates found: ['2025-02-01']
 🔍 Date 2025-02-01 completeness: {totalActiveFunds: 1, fundsWithThisDate: 1, fundsWithoutThisDate: 0, missingFunds: Array(0)}
 🔍 Date completeness analysis: {completeDates: 1, incompleteDates: 0, incompleteDetails: Array(0)}
 🔍 All valuation dates are complete across all funds
 ✅ [VALUATION CHECK] PASSED - Common dates found: ['2025-02-01']
 ✅ [VALUATION CHECK] Portfolio IRR can be calculated for these dates: ['2025-02-01']
 Filtering inactive holdings from: 2 holdings
 All holdings status values: (2) [{…}, {…}]
 Holding ID 1398 (Cash): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Holding ID 1399 (Artemis Income): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Found inactive holdings: []
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 🔍 Valuation Date Detection Debug: {totalHoldings: 2, allActiveHoldings: 2, activeHoldingsExcludingCash: 1, excludedCashFunds: 1, holdingsData: Array(1)}
 🔍 All unique valuation dates found: ['2025-02-01']
 🔍 Date 2025-02-01 completeness: {totalActiveFunds: 1, fundsWithThisDate: 1, fundsWithoutThisDate: 0, missingFunds: Array(0)}
 🔍 Date completeness analysis: {completeDates: 1, incompleteDates: 0, incompleteDetails: Array(0)}
 🔍 All valuation dates are complete across all funds
 ✅ [VALUATION CHECK] PASSED - Common dates found: ['2025-02-01']
 ✅ [VALUATION CHECK] Portfolio IRR can be calculated for these dates: ['2025-02-01']
 Mapping IRR values from holdings data for 2 funds
 No IRR data for fund 1398 (Cash)
 Mapped IRR for fund 1399 (Artemis Income): {irr: 104.5, date: '2025-02-01'}
 Provider switches loaded: []
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
usePresence.ts:138 WebSocket connection to 'ws://localhost:8001/api/ws/presence/irr-calculation:product-278' failed: WebSocket is closed before the connection is established.
(anonymous) @ usePresence.ts:138
safelyCallDestroy @ chunk-QYFCA5BS.js?v=68f90eaa:16796
commitHookEffectListUnmount @ chunk-QYFCA5BS.js?v=68f90eaa:16923
invokePassiveEffectUnmountInDEV @ chunk-QYFCA5BS.js?v=68f90eaa:18413
invokeEffectsInDev @ chunk-QYFCA5BS.js?v=68f90eaa:19754
commitDoubleInvokeEffectsInDEV @ chunk-QYFCA5BS.js?v=68f90eaa:19735
flushPassiveEffectsImpl @ chunk-QYFCA5BS.js?v=68f90eaa:19556
flushPassiveEffects @ chunk-QYFCA5BS.js?v=68f90eaa:19500
(anonymous) @ chunk-QYFCA5BS.js?v=68f90eaa:19381
workLoop @ chunk-QYFCA5BS.js?v=68f90eaa:197
flushWork @ chunk-QYFCA5BS.js?v=68f90eaa:176
performWorkUntilDeadline @ chunk-QYFCA5BS.js?v=68f90eaa:384
usePresence.ts:115 ❌ usePresence: WebSocket error: Event {isTrusted: true, type: 'error', target: WebSocket, currentTarget: WebSocket, eventPhase: 2, …}
ws.onerror @ usePresence.ts:115
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Filtering inactive holdings from: 2 holdings
 All holdings status values: (2) [{…}, {…}]
 Holding ID 1398 (Cash): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Holding ID 1399 (Artemis Income): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Found inactive holdings: []
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 🔍 Valuation Date Detection Debug: {totalHoldings: 2, allActiveHoldings: 2, activeHoldingsExcludingCash: 1, excludedCashFunds: 1, holdingsData: Array(1)}
 🔍 All unique valuation dates found: ['2025-02-01']
 🔍 Date 2025-02-01 completeness: {totalActiveFunds: 1, fundsWithThisDate: 1, fundsWithoutThisDate: 0, missingFunds: Array(0)}
 🔍 Date completeness analysis: {completeDates: 1, incompleteDates: 0, incompleteDetails: Array(0)}
 🔍 All valuation dates are complete across all funds
 ✅ [VALUATION CHECK] PASSED - Common dates found: ['2025-02-01']
 ✅ [VALUATION CHECK] Portfolio IRR can be calculated for these dates: ['2025-02-01']
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Filtering inactive holdings from: 2 holdings
 All holdings status values: (2) [{…}, {…}]
 Holding ID 1398 (Cash): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Holding ID 1399 (Artemis Income): {rawStatus: 'active', statusString: 'active', isStatusInactive: false, end_date: undefined, isInactive: false}
 Found inactive holdings: []
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 🔍 Valuation Date Detection Debug: {totalHoldings: 2, allActiveHoldings: 2, activeHoldingsExcludingCash: 1, excludedCashFunds: 1, holdingsData: Array(1)}
 🔍 All unique valuation dates found: ['2025-02-01']
 🔍 Date 2025-02-01 completeness: {totalActiveFunds: 1, fundsWithThisDate: 1, fundsWithoutThisDate: 0, missingFunds: Array(0)}
 🔍 Date completeness analysis: {completeDates: 1, incompleteDates: 0, incompleteDetails: Array(0)}
 🔍 All valuation dates are complete across all funds
 ✅ [VALUATION CHECK] PASSED - Common dates found: ['2025-02-01']
 ✅ [VALUATION CHECK] Portfolio IRR can be calculated for these dates: ['2025-02-01']
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Mapping IRR values from holdings data for 2 funds
 No IRR data for fund 1398 (Cash)
 Mapped IRR for fund 1399 (Artemis Income): {irr: 104.5, date: '2025-02-01'}
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]
 Creating Previous Funds entry with 0 inactive holdings
 No inactive holdings found, not creating Previous Funds entry
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 Calculating total investments...
 Investments only for holding 1398 (Cash): 0
 Investments only for holding 1399 (Artemis Income): 110
 Total investments (Investment type only): 110
 All holdings before filtering: (2) [{…}, {…}]
 Active holdings after filtering: (2) [{…}, {…}]

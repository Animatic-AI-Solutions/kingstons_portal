# Product Owners Field Mapping - 25 Fields (Updated 2025-12-03)

## Database Schema: product_owners Table

This document maps the complete 25-field schema of the `product_owners` table, including the 3 new fields added via database migration on 2025-12-03.

---

## Field Categories and Complete Mapping

### 1. Core Identity Fields (6 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `id` | bigint | PRIMARY KEY | Auto-generated unique identifier | Generated by database |
| `created_at` | timestamp | DEFAULT NOW() | Creation timestamp | Auto-populated |
| `status` | text | DEFAULT 'active' | Record status (active/inactive) | Dropdown: active, inactive |
| `firstname` | text | NOT NULL | First name | Required text input |
| `surname` | text | NOT NULL | Last name/surname | Required text input |
| `known_as` | text | Optional | Preferred name/nickname | Optional text input |

---

### 2. Personal Details (8 fields) **ğŸ†• 3 NEW FIELDS**

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| **`title`** ğŸ†• | text | Optional | Honorific title | **NEW Dropdown**: Mr, Mrs, Miss, Ms, Dr, Prof, Rev, Sir, Dame, Lord, Lady, Other |
| **`middle_names`** ğŸ†• | text | Optional | Middle name(s) | **NEW Text input** (optional) |
| **`relationship_status`** ğŸ†• | text | Optional | Marital status | **NEW Dropdown**: Single, Married, Divorced, Widowed, Civil Partnership, Separated, Cohabiting |
| `gender` | text | Optional | Gender identity | Dropdown: Male, Female, Other, Prefer not to say |
| `previous_names` | text | Optional | Previous/maiden names | Text input |
| `dob` | date | Optional | Date of birth | Date picker |
| `age` | integer | Optional/Calculated | Age (can be calculated from DOB) | Read-only or calculated field |
| `place_of_birth` | text | Optional | Place of birth | Text input |

**Field Positioning in Form**:
- `title` should appear **before firstname** (e.g., "Title: [Mr] Firstname: [John]")
- `middle_names` should appear **between firstname and surname**
- `relationship_status` should appear in the **Personal Information section** alongside gender

---

### 3. Contact Information (4 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `email_1` | text | Optional | Primary email address | Email input with validation |
| `email_2` | text | Optional | Secondary email address | Email input with validation |
| `phone_1` | text | Optional | Primary phone number | Phone input |
| `phone_2` | text | Optional | Secondary phone number | Phone input |

**Validation Requirements**:
- Email fields must validate email format (RFC 5322)
- Phone fields should accept international formats
- Consider multi-input component (add/remove buttons) instead of comma-separated

---

### 4. Residential Information (2 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `moved_in_date` | date | Optional | Date moved to current address | Date picker |
| `address_id` | bigint | FOREIGN KEY | Reference to addresses table | Address lookup/selection |

**Note**: Address details are stored in a separate `addresses` table with foreign key relationship.

---

### 5. Client Profiling (2 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `three_words` | text | Optional | Three words describing the client | Text input (short) |
| `share_data_with` | text | Optional | Data sharing preferences | Text input or dropdown |

---

### 6. Employment Information (2 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `employment_status` | text | Optional | Employment status | Dropdown: Employed, Self-employed, Unemployed, Retired, Student, Other |
| `occupation` | text | Optional | Job title/occupation | Text input |

---

### 7. Identity & Compliance (4 fields)

| Field Name | Type | Constraints | Description | Frontend Usage |
|------------|------|-------------|-------------|----------------|
| `passport_expiry_date` | date | Optional | Passport expiration date | Date picker |
| `ni_number` | text | Optional | National Insurance number (UK) | Text input with format validation |
| `aml_result` | text | Optional | AML check result | Dropdown: Pass, Fail, Pending, Not Required |
| `aml_date` | date | Optional | AML check date | Date picker |

**Validation Requirements**:
- `ni_number` format: AA 12 34 56 C (UK format)
- `passport_expiry_date` must be future date
- `aml_date` must be in the past

---

## Frontend Type Definition (TypeScript)

```typescript
// types/productOwner.ts

export interface ProductOwnerFormData {
  // Core Identity (6 fields)
  id?: string;  // Optional for new records
  created_at?: Date;
  status: 'active' | 'inactive';
  firstname: string;  // Required
  surname: string;    // Required
  known_as?: string;

  // Personal Details (8 fields) - NEW FIELDS ADDED
  title?: 'Mr' | 'Mrs' | 'Miss' | 'Ms' | 'Dr' | 'Prof' | 'Rev' | 'Sir' | 'Dame' | 'Lord' | 'Lady' | 'Other';  // ğŸ†• NEW
  middle_names?: string;  // ğŸ†• NEW
  relationship_status?: 'Single' | 'Married' | 'Divorced' | 'Widowed' | 'Civil Partnership' | 'Separated' | 'Cohabiting';  // ğŸ†• NEW
  gender?: 'Male' | 'Female' | 'Other' | 'Prefer not to say';
  previous_names?: string;
  dob?: Date;
  age?: number;
  place_of_birth?: string;

  // Contact Information (4 fields)
  email_1?: string;
  email_2?: string;
  phone_1?: string;
  phone_2?: string;

  // Residential Information (2 fields)
  moved_in_date?: Date;
  address_id?: string;

  // Client Profiling (2 fields)
  three_words?: string;
  share_data_with?: string;

  // Employment Information (2 fields)
  employment_status?: 'Employed' | 'Self-employed' | 'Unemployed' | 'Retired' | 'Student' | 'Other';
  occupation?: string;

  // Identity & Compliance (4 fields)
  passport_expiry_date?: Date;
  ni_number?: string;
  aml_result?: 'Pass' | 'Fail' | 'Pending' | 'Not Required';
  aml_date?: Date;
}

// Constants for dropdown options
export const TITLE_OPTIONS = [
  'Mr', 'Mrs', 'Miss', 'Ms', 'Dr', 'Prof',
  'Rev', 'Sir', 'Dame', 'Lord', 'Lady', 'Other'
] as const;

export const RELATIONSHIP_STATUS_OPTIONS = [
  'Single', 'Married', 'Divorced', 'Widowed',
  'Civil Partnership', 'Separated', 'Cohabiting'
] as const;

export const GENDER_OPTIONS = [
  'Male', 'Female', 'Other', 'Prefer not to say'
] as const;

export const EMPLOYMENT_STATUS_OPTIONS = [
  'Employed', 'Self-employed', 'Unemployed',
  'Retired', 'Student', 'Other'
] as const;

export const AML_RESULT_OPTIONS = [
  'Pass', 'Fail', 'Pending', 'Not Required'
] as const;
```

---

## Validation Rules Summary

### Required Fields (2)
1. `firstname` - Must not be empty
2. `surname` - Must not be empty

### Optional Fields (23)
All other fields are optional but should have appropriate validation when provided:

**New Dropdown Fields (2)** ğŸ†•:
- `title` - Must be one of valid title options if provided
- `relationship_status` - Must be one of valid relationship status options if provided

**Existing Dropdown Fields (3)**:
- `gender` - Must be one of valid gender options if provided
- `employment_status` - Must be one of valid employment status options if provided
- `aml_result` - Must be one of valid AML result options if provided

**Date Fields (5)**:
- `dob` - Cannot be in future, reasonable age range (0-120 years)
- `moved_in_date` - Cannot be in future
- `passport_expiry_date` - Should be future date (warn if expired)
- `aml_date` - Cannot be in future

**Email Fields (2)**:
- `email_1`, `email_2` - Must be valid email format (RFC 5322)

**Phone Fields (2)**:
- `phone_1`, `phone_2` - Should accept international phone formats

**Text Fields (9)**:
- `known_as`, `middle_names`, `previous_names`, `place_of_birth`, `three_words`, `share_data_with`, `occupation` - Free text
- `ni_number` - UK NI format validation: `^[A-Z]{2}\d{6}[A-Z]$`

**Foreign Key Field (1)**:
- `address_id` - Must reference valid address in addresses table

**Calculated Field (1)**:
- `age` - Can be auto-calculated from `dob` if both present

---

## Form Layout Recommendation

### Section 1: Core Identity
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Title: [Dropdown: Mr/Mrs/Dr/etc] ğŸ†•    â”‚
â”‚ First Name: [Text Input] *             â”‚
â”‚ Middle Names: [Text Input] ğŸ†•          â”‚
â”‚ Surname: [Text Input] *                â”‚
â”‚ Known As: [Text Input]                 â”‚
â”‚ Status: [Dropdown: Active/Inactive]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 2: Personal Details
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gender: [Dropdown]                      â”‚
â”‚ Relationship Status: [Dropdown] ğŸ†•     â”‚
â”‚ Date of Birth: [Date Picker]           â”‚
â”‚ Age: [Auto-calculated or Manual]       â”‚
â”‚ Place of Birth: [Text Input]           â”‚
â”‚ Previous Names: [Text Input]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 3: Contact Information
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Primary Email: [Email Input]           â”‚
â”‚ Secondary Email: [Email Input]         â”‚
â”‚ Primary Phone: [Phone Input]           â”‚
â”‚ Secondary Phone: [Phone Input]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 4: Residential Information
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Address: [Lookup/Dropdown]             â”‚
â”‚ Moved In Date: [Date Picker]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 5: Client Profiling
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Three Words: [Text Input (short)]      â”‚
â”‚ Share Data With: [Text Input]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 6: Employment Information
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Employment Status: [Dropdown]          â”‚
â”‚ Occupation: [Text Input]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 7: Identity & Compliance
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ National Insurance: [Text Input]       â”‚
â”‚ Passport Expiry: [Date Picker]         â”‚
â”‚ AML Result: [Dropdown]                 â”‚
â”‚ AML Date: [Date Picker]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Migration Impact Summary

### What Changed (2025-12-03)
- **Fields Added**: 3 (title, middle_names, relationship_status)
- **Previous Total**: 22 fields
- **New Total**: 25 fields
- **Breaking Changes**: None (all new fields are optional)
- **Backward Compatibility**: âœ… Maintained (existing records unaffected)

### Frontend Updates Required
1. âœ… Update ProductOwnerFormData interface (add 3 new fields)
2. âœ… Add TITLE_OPTIONS and RELATIONSHIP_STATUS_OPTIONS constants
3. âœ… Add validation for new dropdown fields
4. âœ… Update form layout to include new fields in correct positions
5. âš ï¸ Verify backend API accepts new fields in POST/PUT operations
6. âš ï¸ Update tests to cover new fields

### Backend Updates Required
1. âš ï¸ **Verify**: ProductOwnerCreate Pydantic model includes new fields
2. âš ï¸ **Verify**: ProductOwnerUpdate Pydantic model includes new fields
3. âš ï¸ **Verify**: API endpoints accept and validate new fields
4. âš ï¸ **Update**: API documentation to reflect new fields

---

## Testing Checklist for New Fields

### Unit Tests
- [ ] Validation accepts all valid title options
- [ ] Validation accepts all valid relationship_status options
- [ ] Validation rejects invalid title values
- [ ] Validation rejects invalid relationship_status values
- [ ] middle_names accepts various text formats (including spaces, hyphens)

### Integration Tests
- [ ] POST /product-owners with title field succeeds
- [ ] POST /product-owners with middle_names field succeeds
- [ ] POST /product-owners with relationship_status field succeeds
- [ ] PUT /product-owners updates title field correctly
- [ ] PUT /product-owners updates middle_names field correctly
- [ ] PUT /product-owners updates relationship_status field correctly
- [ ] GET /product-owners returns new fields in response

### UI Tests
- [ ] Title dropdown renders with all options
- [ ] Middle names text input accepts text
- [ ] Relationship status dropdown renders with all options
- [ ] Form layout positions new fields correctly
- [ ] Form validation handles new fields appropriately
- [ ] Form submission includes new fields in payload

---

## API Payload Example

### POST /product-owners (with new fields)

```json
{
  "status": "active",
  "title": "Dr",
  "firstname": "Jane",
  "middle_names": "Elizabeth",
  "surname": "Smith",
  "known_as": "Liz",
  "relationship_status": "Married",
  "gender": "Female",
  "dob": "1985-03-15",
  "email_1": "jane.smith@example.com",
  "phone_1": "+44 7700 900123",
  "employment_status": "Employed",
  "occupation": "Financial Advisor",
  "ni_number": "AB123456C"
}
```

---

## Summary

The product_owners table now comprehensively supports **25 fields** across 7 logical categories, with 3 new fields added to better capture client identity and relationship information. The schema is well-aligned with wealth management client data requirements and provides appropriate granularity for financial advisory use cases.

**Key Takeaways**:
- âœ… Schema expansion significantly improves prototype-to-production alignment
- âœ… All new fields are optional, maintaining backward compatibility
- âš ï¸ Frontend, backend, and validation updates required for full integration
- âš ï¸ Estimated 3-4 hours of work to complete integration of new fields

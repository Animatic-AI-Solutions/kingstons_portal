2025-10-20 14:11:56,910 - app.api.routes.portfolio_funds - INFO - Array size used: 89
2025-10-20 14:11:56,912 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.061273276085853645, Percentage: 6.1%
2025-10-20 14:11:56,912 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 6.1% for fund 1537 on 2025-02-01     
2025-10-20 14:11:56,913 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1537: {'success': True, 'irr_percentage': 6.1, 'irr_decimal': 0.061273276085853645, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1537, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:56,918 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 6.1, 'irr_decimal': 0.061273276085853645, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1537, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:56,925 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 6.1%
2025-10-20 14:11:56,940 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1537, date=2025-02-01
2025-10-20 14:11:56,955 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7215
2025-10-20 14:11:56,963 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1537, date=2025-02-01
2025-10-20 14:11:56,965 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7741
2025-10-20 14:11:56,968 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7741 with value 6.1%        
2025-10-20 14:11:56,972 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1537 on 2025-02-01: 6.1%
2025-10-20 14:11:56,973 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1537]
2025-10-20 14:11:56,978 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1537        
2025-10-20 14:11:56,979 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1538 for date 2025-02-01
2025-10-20 14:11:56,980 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:56,980 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1538, Date: 2025-02-01
2025-10-20 14:11:56,980 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:56,981 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:56,981 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1538, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:56,981 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:56,984 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:56,985 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:56,985 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1538 has Â£0 valuation      
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 5 activities for fund 1538 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 5 flows from 2016-06-01 to 2023-10-01    
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-3386.22
2025-10-20 14:11:56,987 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-1600.0
2025-10-20 14:11:56,988 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-07-01: Â£610.0
2025-10-20 14:11:56,988 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-2510.0
2025-10-20 14:11:56,988 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£10515.45
2025-10-20 14:11:56,988 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:56,993 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.005245384936983344
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.06294461924380013
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Days in period: 2678
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.5245%
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 6.2945%
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Months in period: 89
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - Array size used: 89
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.06294461924380013, Percentage: 6.3%
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 6.3% for fund 1538 on 2025-02-01     
2025-10-20 14:11:56,995 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1538: {'success': True, 'irr_percentage': 6.3, 'irr_decimal': 0.06294461924380013, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1538, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:56,995 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 6.3, 'irr_decimal': 0.06294461924380013, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1538, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:56,997 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 6.3%
2025-10-20 14:11:56,997 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1538, date=2025-02-01
2025-10-20 14:11:56,997 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7216
2025-10-20 14:11:56,997 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1538, date=2025-02-01
2025-10-20 14:11:56,999 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7742
2025-10-20 14:11:56,999 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7742 with value 6.3%        
2025-10-20 14:11:57,001 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1538 on 2025-02-01: 6.3%
2025-10-20 14:11:57,001 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1538]
2025-10-20 14:11:57,001 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1538        
2025-10-20 14:11:57,001 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1539 for date 2025-02-01
2025-10-20 14:11:57,003 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,003 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1539, Date: 2025-02-01
2025-10-20 14:11:57,003 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:57,003 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,003 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1539, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:57,003 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,006 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,008 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,008 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1539 has Â£0 valuation      
2025-10-20 14:11:57,008 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1539 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:57,008 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,008 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2022-03-01 to 2023-10-01    
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£-1914.92
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£2018.18
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.0027680486693364426
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.03321658403203731
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO - Days in period: 579
2025-10-20 14:11:57,010 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.2768%
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 3.3217%
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - Months in period: 20
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - Array size used: 20
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.03321658403203731, Percentage: 3.3%
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 3.3% for fund 1539 on 2025-02-01     
2025-10-20 14:11:57,012 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1539: {'success': True, 'irr_percentage': 3.3, 'irr_decimal': 0.03321658403203731, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1539, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,012 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 3.3, 'irr_decimal': 0.03321658403203731, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1539, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,014 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 3.3%
2025-10-20 14:11:57,014 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1539, date=2025-02-01
2025-10-20 14:11:57,016 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7217
2025-10-20 14:11:57,016 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1539, date=2025-02-01
2025-10-20 14:11:57,018 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7743
2025-10-20 14:11:57,018 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7743 with value 3.3%        
2025-10-20 14:11:57,020 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1539 on 2025-02-01: 3.3%
2025-10-20 14:11:57,020 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1539]
2025-10-20 14:11:57,020 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1539        
2025-10-20 14:11:57,021 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1540 for date 2025-02-01
2025-10-20 14:11:57,021 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,039 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1540, Date: 2025-02-01
2025-10-20 14:11:57,039 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:57,040 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,040 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1540, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:57,041 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,044 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,054 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,057 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1540 has Â£0 valuation      
2025-10-20 14:11:57,060 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1540 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:57,060 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,061 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2020-11-01 to 2023-10-01    
2025-10-20 14:11:57,061 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,062 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-11-01: Â£-6100.79
2025-10-20 14:11:57,062 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£5688.76
2025-10-20 14:11:57,062 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,064 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: -0.001995890493131758
2025-10-20 14:11:57,065 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): -0.023950685917581094
2025-10-20 14:11:57,065 - app.api.routes.portfolio_funds - INFO - Days in period: 1064
2025-10-20 14:11:57,065 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,065 - app.api.routes.portfolio_funds - INFO - Monthly IRR: -0.1996%
2025-10-20 14:11:57,066 - app.api.routes.portfolio_funds - INFO - Annualized IRR: -2.3951%
2025-10-20 14:11:57,066 - app.api.routes.portfolio_funds - INFO - Months in period: 36
2025-10-20 14:11:57,066 - app.api.routes.portfolio_funds - INFO - Array size used: 36
2025-10-20 14:11:57,066 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: -0.023950685917581094, Percentage: -2.4%
2025-10-20 14:11:57,066 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: -2.4% for fund 1540 on 2025-02-01    
2025-10-20 14:11:57,068 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1540: {'success': True, 'irr_percentage': -2.4, 'irr_decimal': -0.023950685917581094, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1540, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2020-11-01', 'period_end': '2023-10-01', 'days_in_period': 1064}
2025-10-20 14:11:57,068 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': -2.4, 'irr_decimal': -0.023950685917581094, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1540, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2020-11-01', 'period_end': '2023-10-01', 'days_in_period': 1064}
2025-10-20 14:11:57,068 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: -2.4%
2025-10-20 14:11:57,069 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1540, date=2025-02-01
2025-10-20 14:11:57,070 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7218
2025-10-20 14:11:57,070 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1540, date=2025-02-01
2025-10-20 14:11:57,072 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7744
2025-10-20 14:11:57,072 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7744 with value -2.4%       
2025-10-20 14:11:57,075 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1540 on 2025-02-01: -2.4%
2025-10-20 14:11:57,075 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1540]
2025-10-20 14:11:57,075 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1540        
2025-10-20 14:11:57,076 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1541 for date 2025-02-01
2025-10-20 14:11:57,076 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,076 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1541, Date: 2025-02-01
2025-10-20 14:11:57,076 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:57,076 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,077 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1541, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:57,077 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,080 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,086 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,091 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1541 has Â£0 valuation      
2025-10-20 14:11:57,093 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 10 activities for fund 1541 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:57,097 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,121 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 10 flows from 2016-06-01 to 2024-01-01
2025-10-20 14:11:57,122 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,123 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-2201.04
2025-10-20 14:11:57,123 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-1040.0
2025-10-20 14:11:57,123 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-08-01: Â£366.0
2025-10-20 14:11:57,124 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-1631.5
2025-10-20 14:11:57,124 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-01-01: Â£2240.36
2025-10-20 14:11:57,124 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-03-01: Â£151.01
2025-10-20 14:11:57,124 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-08-01: Â£193.18
2025-10-20 14:11:57,124 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-12-01: Â£103.87
2025-10-20 14:11:57,125 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-10-01: Â£21.1
2025-10-20 14:11:57,125 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2024-01-01: Â£38.19
2025-10-20 14:11:57,125 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,132 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: -0.013115613069494159
2025-10-20 14:11:57,133 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): -0.1573873568339299
2025-10-20 14:11:57,133 - app.api.routes.portfolio_funds - INFO - Days in period: 2770
2025-10-20 14:11:57,133 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,133 - app.api.routes.portfolio_funds - INFO - Monthly IRR: -1.3116%
2025-10-20 14:11:57,133 - app.api.routes.portfolio_funds - INFO - Annualized IRR: -15.7387%
2025-10-20 14:11:57,134 - app.api.routes.portfolio_funds - INFO - Months in period: 92
2025-10-20 14:11:57,134 - app.api.routes.portfolio_funds - INFO - Array size used: 92
2025-10-20 14:11:57,134 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: -0.1573873568339299, Percentage: -15.7%
2025-10-20 14:11:57,134 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: -15.7% for fund 1541 on 2025-02-01   
2025-10-20 14:11:57,134 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1541: {'success': True, 'irr_percentage': -15.7, 'irr_decimal': -0.1573873568339299, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1541, 'valuation_amount': 0.0, 'cash_flows_count': 10, 'period_start': '2016-06-01', 'period_end': '2024-01-01', 'days_in_period': 2770}
2025-10-20 14:11:57,135 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': -15.7, 'irr_decimal': -0.1573873568339299, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1541, 'valuation_amount': 0.0, 'cash_flows_count': 10, 'period_start': '2016-06-01', 'period_end': '2024-01-01', 'days_in_period': 2770}
2025-10-20 14:11:57,135 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: -15.7%
2025-10-20 14:11:57,135 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1541, date=2025-02-01
2025-10-20 14:11:57,136 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7219
2025-10-20 14:11:57,136 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1541, date=2025-02-01
2025-10-20 14:11:57,138 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7745
2025-10-20 14:11:57,138 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7745 with value -15.7%      
2025-10-20 14:11:57,140 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1541 on 2025-02-01: -15.7%
2025-10-20 14:11:57,140 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1541]
2025-10-20 14:11:57,140 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1541        
2025-10-20 14:11:57,140 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1542 for date 2025-02-01
2025-10-20 14:11:57,140 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,140 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1542, Date: 2025-02-01
2025-10-20 14:11:57,142 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:57,142 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,142 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1542, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:57,142 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,144 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,146 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,146 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1542 has Â£0 valuation      
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1542 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2022-03-01 to 2023-10-01    
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£-4262.23
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£4393.85
2025-10-20 14:11:57,148 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.001601983829673026
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.019223805956076312
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO - Days in period: 579
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.1602%
2025-10-20 14:11:57,150 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 1.9224%
2025-10-20 14:11:57,151 - app.api.routes.portfolio_funds - INFO - Months in period: 20
2025-10-20 14:11:57,151 - app.api.routes.portfolio_funds - INFO - Array size used: 20
2025-10-20 14:11:57,151 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.019223805956076312, Percentage: 1.9%
2025-10-20 14:11:57,151 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 1.9% for fund 1542 on 2025-02-01     
2025-10-20 14:11:57,151 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1542: {'success': True, 'irr_percentage': 1.9, 'irr_decimal': 0.019223805956076312, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1542, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,151 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 1.9, 'irr_decimal': 0.019223805956076312, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1542, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,153 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 1.9%
2025-10-20 14:11:57,153 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1542, date=2025-02-01
2025-10-20 14:11:57,153 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7220
2025-10-20 14:11:57,153 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1542, date=2025-02-01
2025-10-20 14:11:57,155 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7746
2025-10-20 14:11:57,155 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7746 with value 1.9%        
2025-10-20 14:11:57,157 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1542 on 2025-02-01: 1.9%
2025-10-20 14:11:57,157 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1542]
2025-10-20 14:11:57,157 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1542        
2025-10-20 14:11:57,157 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1543 for date 2025-02-01
2025-10-20 14:11:57,159 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,159 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1543, Date: 2025-02-01
2025-10-20 14:11:57,159 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-02-01
2025-10-20 14:11:57,159 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,159 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1543, date 2025-02-01  (BYPASSING CACHE)
2025-10-20 14:11:57,159 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,163 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,165 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,165 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1543 has Â£0 valuation      
2025-10-20 14:11:57,167 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 30 activities for fund 1543 up to 2025-02-01 (using end-of-day filter: 2025-02-01 23:59:59.999999)
2025-10-20 14:11:57,168 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,168 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 25 flows from 2008-12-01 to 2023-10-01   
2025-10-20 14:11:57,168 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,188 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2008-12-01: Â£-600.0
2025-10-20 14:11:57,189 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-01-01: Â£-600.0
2025-10-20 14:11:57,190 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-02-01: Â£-600.0
2025-10-20 14:11:57,190 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-03-01: Â£-600.0
2025-10-20 14:11:57,190 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-04-01: Â£-600.0
2025-10-20 14:11:57,191 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-05-01: Â£-7800.0
2025-10-20 14:11:57,191 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-10-01: Â£1900.0
2025-10-20 14:11:57,191 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2010-09-01: Â£525.0
2025-10-20 14:11:57,191 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2012-03-01: Â£2050.0
2025-10-20 14:11:57,191 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2012-07-01: Â£5889.66
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2013-02-01: Â£2685.15
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-6240.960000000001
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-3760.0
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-07-01: Â£496.93
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-08-01: Â£1130.0
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-5898.5
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2019-01-01: Â£0.0
2025-10-20 14:11:57,192 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2019-06-01: Â£0.0
2025-10-20 14:11:57,205 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-02-01: Â£-2212.53
2025-10-20 14:11:57,206 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-03-01: Â£-151.01
2025-10-20 14:11:57,207 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-09-01: Â£-165.39
2025-10-20 14:11:57,207 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-11-01: Â£6100.789999999999
2025-10-20 14:11:57,208 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2021-12-01: Â£0.0
2025-10-20 14:11:57,208 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£6177.15
2025-10-20 14:11:57,209 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£12002.56
2025-10-20 14:11:57,213 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.005912399138982893
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.07094878966779472
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Days in period: 5417
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.5912%
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 7.0949%
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Months in period: 179
2025-10-20 14:11:57,278 - app.api.routes.portfolio_funds - INFO - Array size used: 179
2025-10-20 14:11:57,280 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.07094878966779472, Percentage: 7.1%
2025-10-20 14:11:57,280 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 7.1% for fund 1543 on 2025-02-01     
2025-10-20 14:11:57,280 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1543: {'success': True, 'irr_percentage': 7.1, 'irr_decimal': 0.07094878966779472, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1543, 'valuation_amount': 0.0, 'cash_flows_count': 25, 'period_start': '2008-12-01', 'period_end': '2023-10-01', 'days_in_period': 5417}
2025-10-20 14:11:57,280 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 7.1, 'irr_decimal': 0.07094878966779472, 'calculation_date': '2025-02-01', 'portfolio_fund_id': 1543, 'valuation_amount': 0.0, 'cash_flows_count': 25, 'period_start': '2008-12-01', 'period_end': '2023-10-01', 'days_in_period': 5417}
2025-10-20 14:11:57,280 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 7.1%
2025-10-20 14:11:57,280 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1543, date=2025-02-01
2025-10-20 14:11:57,282 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7221
2025-10-20 14:11:57,282 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1543, date=2025-02-01
2025-10-20 14:11:57,284 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7747
2025-10-20 14:11:57,284 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7747 with value 7.1%        
2025-10-20 14:11:57,286 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1543 on 2025-02-01: 7.1%
2025-10-20 14:11:57,286 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1543]
2025-10-20 14:11:57,286 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1543        
2025-10-20 14:11:57,287 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1536, 1537, 1538,, 1539, 1540, 1541, 1542, 1543]
2025-10-20 14:11:57,287 - app.services.irr_cascade_service - INFO - ğŸ—‘ï¸ Invalidated 0 IRR cache entries for 8 recalculated funds
2025-10-20 14:11:57,287 - app.services.irr_cascade_service - INFO - ğŸ“Š Recalculated 8 fund IRRs for portfolio 316 on 2025-02-01
2025-10-20 14:11:57,289 - app.services.irr_cascade_service - INFO - ğŸ“Š Portfolio 316 completeness for 2025-02-01: 8/8 = True
2025-10-20 14:11:57,290 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1541, 1542, 1543,, 1540, 1536, 1537, 1539, 1538]
2025-10-20 14:11:57,290 - app.services.irr_cascade_service - WARNING - âš ï¸ Targeted cache invalidation found 0 entries, clearing entire cachee for portfolio 316
2025-10-20 14:11:57,290 - app.services.irr_cascade_service - INFO - ğŸ—‘ï¸ Pre-calculation: Cleared 0 total cache entries to ensure fresh calcullation
2025-10-20 14:11:57,291 - app.api.routes.portfolio_funds - INFO - Calculating aggregated IRR for 8 portfolio funds  (BYPASSING CACHE)       
2025-10-20 14:11:57,291 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh calculation as requested
2025-10-20 14:11:57,291 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-02-01
2025-10-20 14:11:57,291 - app.api.routes.portfolio_funds - INFO - ğŸš€ Batch fetching valuations for 8 funds (eliminates 8 individual requests)
2025-10-20 14:11:57,293 - app.api.routes.portfolio_funds - INFO - âœ… Batch valuation optimization complete - Fund valuations: {1536: 0.0, 1537: 0.0, 1538: 0.0, 1539: 0.0, 1540: 0.0, 1541: 0.0, 1542: 0.0, 1543: 0.0}
2025-10-20 14:11:57,297 - app.api.routes.portfolio_funds - INFO - ğŸ“Š Processing 70 activities across 8 funds
2025-10-20 14:11:57,298 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,423 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.004242689361824592
2025-10-20 14:11:57,423 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.050912272341895104
2025-10-20 14:11:57,423 - app.api.routes.portfolio_funds - INFO - Days in period: 5540
2025-10-20 14:11:57,423 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,423 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.4243%
2025-10-20 14:11:57,424 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 5.0912%
2025-10-20 14:11:57,424 - app.api.routes.portfolio_funds - INFO - Months in period: 183
2025-10-20 14:11:57,424 - app.api.routes.portfolio_funds - INFO - Array size used: 183
2025-10-20 14:11:57,425 - app.api.routes.portfolio_funds - INFO - ğŸ“Š IRR Calculation Complete: 5.1% over 5540 days (34 cash flow periods)   
2025-10-20 14:11:57,425 - app.api.routes.portfolio_funds - INFO - âœ… Successfully calculated aggregate IRR for 8 portfolio funds: 5.1%      
2025-10-20 14:11:57,450 - app.services.irr_cascade_service - INFO - ğŸ“Š Updated portfolio IRR for portfolio 316 on 2025-02-01: 5.1%
2025-10-20 14:11:57,450 - app.services.irr_cascade_service - INFO - ğŸ”„ [IRR CASCADE] Processing valuation date 2025-05-01
2025-10-20 14:11:57,469 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] ========== RECALCULATING ALL FUND IRRs FOR DATE ==========
2025-10-20 14:11:57,475 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Portfolio ID: 316, Date: 2025-05-01
2025-10-20 14:11:57,480 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,495 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Found 148 funds with valuations on 2025-05-01
2025-10-20 14:11:57,497 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Portfolio 316 has 8 total funds
2025-10-20 14:11:57,500 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Funds with valuations on 2025-05-01: [1655, 1656, 1080, 1081, 1082, 1083, 1084, 1085, 1086, 1087, 1088, 1089, 1090, 1657, 1658, 1399, 1398, 1419, 1420, 1421, 1422, 1435, 1436, 1423, 1424, 1426, 1427, 1428, 1429, 1430, 1432, 1433, 1434, 1445, 1446, 1447, 1448, 1449, 1450, 1451, 1452, 1437, 1438, 1439, 1440, 1441, 1442, 1443, 1444, 1453, 1454, 1457, 1458, 1461, 1462, 1463, 1464, 1465, 1466, 1467, 1468, 1469, 1470, 1471, 1472, 1531, 1425, 1584, 1585, 1586, 1587, 1588, 1589, 1590, 1591, 1592, 1593, 1594, 1595, 1599, 1600, 1601, 1602, 1603, 1604, 1605, 1606, 1607, 1608, 1650, 1651, 1652, 1653, 1654, 1757, 1758, 1800, 1799, 1802, 1801, 1804, 1803, 1806, 1807, 1808, 1809, 1810, 1811, 1812, 1813, 1814, 1815, 1805, 1816, 1817, 1818, 1819, 1825, 1826, 1827, 1824, 1829, 1821, 1822, 1823, 1820, 1828, 1845, 1844, 1889, 1890, 1891, 1523, 1524, 1525, 1526, 1527, 1528, 1529, 1530, 1536, 1537, 1538, 1539, 1540, 1541, 1542, 1543]
2025-10-20 14:11:57,510 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Portfolio fund IDs: [1541, 1542, 1543, 1540, 1536, 1537, 1539, 1538]
2025-10-20 14:11:57,510 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Relevant fund IDs for IRR calculation: [1536, 1537, 1538, 1539, 1540, 1541, 1542, 1543]
2025-10-20 14:11:57,510 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Expected 8 funds, got 8 funds
2025-10-20 14:11:57,510 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1536 for date 2025-05-01
2025-10-20 14:11:57,511 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,511 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1536, Date: 2025-05-01
2025-10-20 14:11:57,511 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,511 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,511 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1536, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,511 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,514 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,515 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,516 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1536 has Â£0 valuation      
2025-10-20 14:11:57,517 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 14 activities for fund 1536 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,517 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,517 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 13 flows from 2016-03-01 to 2024-02-01   
2025-10-20 14:11:57,517 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,517 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-03-01: Â£-15240.0
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£15214.54
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-01-01: Â£-2240.36
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-02-01: Â£2212.53
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-03-01: Â£0.0
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-07-01: Â£-1.0
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-08-01: Â£-193.18
2025-10-20 14:11:57,518 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-09-01: Â£165.39
2025-10-20 14:11:57,519 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-12-01: Â£-103.87
2025-10-20 14:11:57,519 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-10-01: Â£-21.1
2025-10-20 14:11:57,519 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-04-01: Â£1.0
2025-10-20 14:11:57,519 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2024-01-01: Â£-38.19
2025-10-20 14:11:57,519 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2024-02-01: Â£1.0
2025-10-20 14:11:57,520 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: -0.007712714344521254
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): -0.09255257213425505
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Days in period: 2893
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Monthly IRR: -0.7713%
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Annualized IRR: -9.2553%
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Months in period: 96
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - Array size used: 96
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: -0.09255257213425505, Percentage: -9.3%
2025-10-20 14:11:57,528 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: -9.3% for fund 1536 on 2025-05-01    
2025-10-20 14:11:57,530 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1536: {'success': True, 'irr_percentage': -9.3, 'irr_decimal': -0.09255257213425505, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1536, 'valuation_amount': 0.0, 'cash_flows_count': 13, 'period_start': '2016-03-01', 'period_end': '2024-02-01', 'days_in_period': 2893}
2025-10-20 14:11:57,530 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': -9.3, 'irr_decimal': -0.09255257213425505, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1536, 'valuation_amount': 0.0, 'cash_flows_count': 13, 'period_start': '2016-03-01', 'period_end': '2024-02-01', 'days_in_period': 2893}
2025-10-20 14:11:57,530 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: -9.3%
2025-10-20 14:11:57,530 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1536, date=2025-05-01
2025-10-20 14:11:57,532 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7206
2025-10-20 14:11:57,532 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1536, date=2025-05-01
2025-10-20 14:11:57,532 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 8023
2025-10-20 14:11:57,532 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 8023 with value -9.3%       
2025-10-20 14:11:57,534 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1536 on 2025-05-01: -9.3%
2025-10-20 14:11:57,534 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1536]
2025-10-20 14:11:57,534 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1536        
2025-10-20 14:11:57,536 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1537 for date 2025-05-01
2025-10-20 14:11:57,536 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,536 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1537, Date: 2025-05-01
2025-10-20 14:11:57,536 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,536 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,537 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1537, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,537 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,541 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,543 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,543 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1537 has Â£0 valuation      
2025-10-20 14:11:57,543 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 5 activities for fund 1537 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,543 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 5 flows from 2016-06-01 to 2023-10-01    
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-3386.32
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-1600.0
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-08-01: Â£610.0
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-2510.0
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£10402.61
2025-10-20 14:11:57,545 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,583 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.005106106340487804
2025-10-20 14:11:57,589 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.061273276085853645
2025-10-20 14:11:57,589 - app.api.routes.portfolio_funds - INFO - Days in period: 2678
2025-10-20 14:11:57,590 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,595 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.5106%
2025-10-20 14:11:57,597 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 6.1273%
2025-10-20 14:11:57,611 - app.api.routes.portfolio_funds - INFO - Months in period: 89
2025-10-20 14:11:57,612 - app.api.routes.portfolio_funds - INFO - Array size used: 89
2025-10-20 14:11:57,616 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.061273276085853645, Percentage: 6.1%
2025-10-20 14:11:57,621 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 6.1% for fund 1537 on 2025-05-01
2025-10-20 14:11:57,628 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1537: {'success': True, 'irr_percentage': 6.1, 'irr_decimal': 0.061273276085853645, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1537, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:57,630 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 6.1, 'irr_decimal': 0.061273276085853645, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1537, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:57,635 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 6.1%
2025-10-20 14:11:57,637 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1537, date=2025-05-01
2025-10-20 14:11:57,639 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7207
2025-10-20 14:11:57,639 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1537, date=2025-05-01
2025-10-20 14:11:57,640 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7734
2025-10-20 14:11:57,641 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7734 with value 6.1%        
2025-10-20 14:11:57,643 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1537 on 2025-05-01: 6.1%
2025-10-20 14:11:57,643 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1537]
2025-10-20 14:11:57,643 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1537        
2025-10-20 14:11:57,643 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1538 for date 2025-05-01
2025-10-20 14:11:57,644 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,644 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1538, Date: 2025-05-01
2025-10-20 14:11:57,644 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,644 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,644 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1538, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,644 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,647 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,648 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,648 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1538 has Â£0 valuation      
2025-10-20 14:11:57,649 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 5 activities for fund 1538 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 5 flows from 2016-06-01 to 2023-10-01    
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-3386.22
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-1600.0
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-07-01: Â£610.0
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-2510.0
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£10515.45
2025-10-20 14:11:57,650 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.005245384936983344
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.06294461924380013
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Days in period: 2678
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.5245%
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 6.2945%
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Months in period: 89
2025-10-20 14:11:57,658 - app.api.routes.portfolio_funds - INFO - Array size used: 89
2025-10-20 14:11:57,660 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.06294461924380013, Percentage: 6.3%
2025-10-20 14:11:57,660 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 6.3% for fund 1538 on 2025-05-01     
2025-10-20 14:11:57,660 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1538: {'success': True, 'irr_percentage': 6.3, 'irr_decimal': 0.06294461924380013, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1538, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:57,660 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 6.3, 'irr_decimal': 0.06294461924380013, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1538, 'valuation_amount': 0.0, 'cash_flows_count': 5, 'period_start': '2016-06-01', 'period_end': '2023-10-01', 'days_in_period': 2678}
2025-10-20 14:11:57,660 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 6.3%
2025-10-20 14:11:57,662 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1538, date=2025-05-01
2025-10-20 14:11:57,662 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7208
2025-10-20 14:11:57,662 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1538, date=2025-05-01
2025-10-20 14:11:57,664 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7735
2025-10-20 14:11:57,664 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7735 with value 6.3%        
2025-10-20 14:11:57,665 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1538 on 2025-05-01: 6.3%
2025-10-20 14:11:57,665 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1538]
2025-10-20 14:11:57,665 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1538        
2025-10-20 14:11:57,667 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1539 for date 2025-05-01
2025-10-20 14:11:57,667 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,667 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1539, Date: 2025-05-01
2025-10-20 14:11:57,667 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,667 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,667 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1539, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,667 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,669 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,672 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,672 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1539 has Â£0 valuation      
2025-10-20 14:11:57,674 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1539 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,674 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,674 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2022-03-01 to 2023-10-01    
2025-10-20 14:11:57,674 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,675 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£-1914.92
2025-10-20 14:11:57,675 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£2018.18
2025-10-20 14:11:57,675 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,676 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.0027680486693364426
2025-10-20 14:11:57,676 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.03321658403203731
2025-10-20 14:11:57,676 - app.api.routes.portfolio_funds - INFO - Days in period: 579
2025-10-20 14:11:57,676 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,676 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.2768%
2025-10-20 14:11:57,677 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 3.3217%
2025-10-20 14:11:57,677 - app.api.routes.portfolio_funds - INFO - Months in period: 20
2025-10-20 14:11:57,677 - app.api.routes.portfolio_funds - INFO - Array size used: 20
2025-10-20 14:11:57,677 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.03321658403203731, Percentage: 3.3%
2025-10-20 14:11:57,678 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 3.3% for fund 1539 on 2025-05-01     
2025-10-20 14:11:57,678 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1539: {'success': True, 'irr_percentage': 3.3, 'irr_decimal': 0.03321658403203731, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1539, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,678 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 3.3, 'irr_decimal': 0.03321658403203731, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1539, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,678 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 3.3%
2025-10-20 14:11:57,679 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1539, date=2025-05-01
2025-10-20 14:11:57,696 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7209
2025-10-20 14:11:57,696 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1539, date=2025-05-01
2025-10-20 14:11:57,698 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7736
2025-10-20 14:11:57,699 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7736 with value 3.3%
2025-10-20 14:11:57,702 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1539 on 2025-05-01: 3.3%
2025-10-20 14:11:57,702 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1539]
2025-10-20 14:11:57,702 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1539        
2025-10-20 14:11:57,702 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1540 for date 2025-05-01
2025-10-20 14:11:57,702 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,703 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1540, Date: 2025-05-01
2025-10-20 14:11:57,711 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,718 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,724 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1540, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,724 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,729 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,731 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,737 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1540 has Â£0 valuation      
2025-10-20 14:11:57,740 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1540 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,746 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,746 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2020-11-01 to 2023-10-01    
2025-10-20 14:11:57,747 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,748 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-11-01: Â£-6100.79
2025-10-20 14:11:57,748 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£5688.76
2025-10-20 14:11:57,749 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,759 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: -0.001995890493131758
2025-10-20 14:11:57,768 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): -0.023950685917581094
2025-10-20 14:11:57,768 - app.api.routes.portfolio_funds - INFO - Days in period: 1064
2025-10-20 14:11:57,768 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - Monthly IRR: -0.1996%
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - Annualized IRR: -2.3951%
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - Months in period: 36
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - Array size used: 36
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: -0.023950685917581094, Percentage: -2.4%
2025-10-20 14:11:57,769 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: -2.4% for fund 1540 on 2025-05-01    
2025-10-20 14:11:57,770 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1540: {'success': True, 'irr_percentage': -2.4, 'irr_decimal': -0.023950685917581094, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1540, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2020-11-01', 'period_end': '2023-10-01', 'days_in_period': 1064}
2025-10-20 14:11:57,770 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': -2.4, 'irr_decimal': -0.023950685917581094, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1540, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2020-11-01', 'period_end': '2023-10-01', 'days_in_period': 1064}
2025-10-20 14:11:57,770 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: -2.4%
2025-10-20 14:11:57,770 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1540, date=2025-05-01
2025-10-20 14:11:57,772 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7210
2025-10-20 14:11:57,772 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1540, date=2025-05-01
2025-10-20 14:11:57,773 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7737
2025-10-20 14:11:57,773 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7737 with value -2.4%       
2025-10-20 14:11:57,776 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1540 on 2025-05-01: -2.4%
2025-10-20 14:11:57,776 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1540]
2025-10-20 14:11:57,776 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1540        
2025-10-20 14:11:57,776 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1541 for date 2025-05-01
2025-10-20 14:11:57,776 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,777 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1541, Date: 2025-05-01
2025-10-20 14:11:57,777 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,777 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,777 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1541, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,777 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,780 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,780 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,780 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1541 has Â£0 valuation      
2025-10-20 14:11:57,782 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 10 activities for fund 1541 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,782 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,782 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 10 flows from 2016-06-01 to 2024-01-01   
2025-10-20 14:11:57,782 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-2201.04
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-1040.0
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-08-01: Â£366.0
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-1631.5
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-01-01: Â£2240.36
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-03-01: Â£151.01
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-08-01: Â£193.18
2025-10-20 14:11:57,784 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-12-01: Â£103.87
2025-10-20 14:11:57,786 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-10-01: Â£21.1
2025-10-20 14:11:57,786 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2024-01-01: Â£38.19
2025-10-20 14:11:57,787 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,799 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: -0.013115613069494159
2025-10-20 14:11:57,801 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): -0.1573873568339299
2025-10-20 14:11:57,801 - app.api.routes.portfolio_funds - INFO - Days in period: 2770
2025-10-20 14:11:57,801 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,801 - app.api.routes.portfolio_funds - INFO - Monthly IRR: -1.3116%
2025-10-20 14:11:57,801 - app.api.routes.portfolio_funds - INFO - Annualized IRR: -15.7387%
2025-10-20 14:11:57,803 - app.api.routes.portfolio_funds - INFO - Months in period: 92
2025-10-20 14:11:57,803 - app.api.routes.portfolio_funds - INFO - Array size used: 92
2025-10-20 14:11:57,803 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: -0.1573873568339299, Percentage: -15.7%
2025-10-20 14:11:57,803 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: -15.7% for fund 1541 on 2025-05-01   
2025-10-20 14:11:57,803 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1541: {'success': True, 'irr_percentage': -15.7, 'irr_decimal': -0.1573873568339299, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1541, 'valuation_amount': 0.0, 'cash_flows_count': 10, 'period_start': '2016-06-01', 'period_end': '2024-01-01', 'days_in_period': 2770}
2025-10-20 14:11:57,803 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': -15.7, 'irr_decimal': -0.1573873568339299, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1541, 'valuation_amount': 0.0, 'cash_flows_count': 10, 'period_start': '2016-06-01', 'period_end': '2024-01-01', 'days_in_period': 2770}
2025-10-20 14:11:57,804 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: -15.7%
2025-10-20 14:11:57,804 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1541, date=2025-05-01
2025-10-20 14:11:57,805 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7211
2025-10-20 14:11:57,806 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1541, date=2025-05-01
2025-10-20 14:11:57,808 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7738
2025-10-20 14:11:57,808 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7738 with value -15.7%      
2025-10-20 14:11:57,830 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1541 on 2025-05-01: -15.7%
2025-10-20 14:11:57,833 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1541]
2025-10-20 14:11:57,834 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1541        
2025-10-20 14:11:57,834 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1542 for date 2025-05-01
2025-10-20 14:11:57,835 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,835 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1542, Date: 2025-05-01
2025-10-20 14:11:57,836 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,836 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,836 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1542, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,837 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,840 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,842 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,843 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1542 has Â£0 valuation      
2025-10-20 14:11:57,845 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 2 activities for fund 1542 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,846 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,847 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 2 flows from 2022-03-01 to 2023-10-01    
2025-10-20 14:11:57,848 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,850 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£-4262.23
2025-10-20 14:11:57,851 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£4393.85
2025-10-20 14:11:57,852 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,854 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.001601983829673026
2025-10-20 14:11:57,855 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.019223805956076312
2025-10-20 14:11:57,856 - app.api.routes.portfolio_funds - INFO - Days in period: 579
2025-10-20 14:11:57,856 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,858 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.1602%
2025-10-20 14:11:57,869 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 1.9224%
2025-10-20 14:11:57,869 - app.api.routes.portfolio_funds - INFO - Months in period: 20
2025-10-20 14:11:57,871 - app.api.routes.portfolio_funds - INFO - Array size used: 20
2025-10-20 14:11:57,874 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.019223805956076312, Percentage: 1.9%
2025-10-20 14:11:57,879 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 1.9% for fund 1542 on 2025-05-01
2025-10-20 14:11:57,885 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1542: {'success': True, 'irr_percentage': 1.9, 'irr_decimal': 0.019223805956076312, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1542, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,886 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 1.9, 'irr_decimal': 0.019223805956076312, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1542, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2022-03-01', 'period_end': '2023-10-01', 'days_in_period': 579}
2025-10-20 14:11:57,887 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 1.9%
2025-10-20 14:11:57,887 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1542, date=2025-05-01
2025-10-20 14:11:57,889 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7212
2025-10-20 14:11:57,890 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1542, date=2025-05-01
2025-10-20 14:11:57,891 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7739
2025-10-20 14:11:57,892 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7739 with value 1.9%        
2025-10-20 14:11:57,898 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1542 on 2025-05-01: 1.9%
2025-10-20 14:11:57,902 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1542]
2025-10-20 14:11:57,908 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1542        
2025-10-20 14:11:57,910 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] Processing fund 1543 for date 2025-05-01
2025-10-20 14:11:57,918 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] ========== CALCULATING FUND IRR ==========
2025-10-20 14:11:57,919 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund ID: 1543, Date: 2025-05-01
2025-10-20 14:11:57,920 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Converted date to date_obj: 2025-05-01
2025-10-20 14:11:57,922 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calling calculate_single_portfolio_fund_irr with bypass_cache=True
2025-10-20 14:11:57,923 - app.api.routes.portfolio_funds - INFO - ğŸ” IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1543, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 14:11:57,924 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh single fund calculation as requested
2025-10-20 14:11:57,931 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:57,932 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Fund valuation: Â£0.0
2025-10-20 14:11:57,933 - app.api.routes.portfolio_funds - WARNING - ğŸ’° DEBUG: âš ï¸  ZERO VALUATION DETECTED! Fund 1543 has Â£0 valuation      
2025-10-20 14:11:57,935 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Found 30 activities for fund 1543 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 14:11:57,935 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âš ï¸  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 14:11:57,935 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Aggregated cash flows: 25 flows from 2008-12-01 to 2023-10-01   
2025-10-20 14:11:57,935 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Total valuation: Â£0.0
2025-10-20 14:11:57,936 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2008-12-01: Â£-600.0
2025-10-20 14:11:57,936 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-01-01: Â£-600.0
2025-10-20 14:11:57,936 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-02-01: Â£-600.0
2025-10-20 14:11:57,936 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-03-01: Â£-600.0
2025-10-20 14:11:57,937 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-04-01: Â£-600.0
2025-10-20 14:11:57,937 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-05-01: Â£-7800.0
2025-10-20 14:11:57,937 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2009-10-01: Â£1900.0
2025-10-20 14:11:57,937 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2010-09-01: Â£525.0
2025-10-20 14:11:57,937 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2012-03-01: Â£2050.0
2025-10-20 14:11:57,938 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2012-07-01: Â£5889.66
2025-10-20 14:11:57,938 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2013-02-01: Â£2685.15
2025-10-20 14:11:57,938 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-06-01: Â£-6240.960000000001
2025-10-20 14:11:57,938 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2016-11-01: Â£-3760.0
2025-10-20 14:11:57,938 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-07-01: Â£496.93
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2017-08-01: Â£1130.0
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2018-02-01: Â£-5898.5
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2019-01-01: Â£0.0
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2019-06-01: Â£0.0
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-02-01: Â£-2212.53
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-03-01: Â£-151.01
2025-10-20 14:11:57,939 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-09-01: Â£-165.39
2025-10-20 14:11:57,940 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2020-11-01: Â£6100.789999999999
2025-10-20 14:11:57,940 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2021-12-01: Â£0.0
2025-10-20 14:11:57,940 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2022-03-01: Â£6177.15
2025-10-20 14:11:57,940 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Cash flow - 2023-10-01: Â£12002.56
2025-10-20 14:11:57,941 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:57,987 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.005912399138982893
2025-10-20 14:11:57,987 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.07094878966779472
2025-10-20 14:11:57,988 - app.api.routes.portfolio_funds - INFO - Days in period: 5417
2025-10-20 14:11:57,988 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:57,988 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.5912%
2025-10-20 14:11:57,988 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 7.0949%
2025-10-20 14:11:57,989 - app.api.routes.portfolio_funds - INFO - Months in period: 179
2025-10-20 14:11:57,989 - app.api.routes.portfolio_funds - INFO - Array size used: 179
2025-10-20 14:11:57,989 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: Final IRR calculation - Decimal: 0.07094878966779472, Percentage: 7.1%
2025-10-20 14:11:57,989 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: IRR calculation completed: 7.1% for fund 1543 on 2025-05-01     
2025-10-20 14:11:57,990 - app.api.routes.portfolio_funds - INFO - ğŸ’° DEBUG: âœ… IRR calculation completed successfully for fund 1543: {'success': True, 'irr_percentage': 7.1, 'irr_decimal': 0.07094878966779472, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1543, 'valuation_amount': 0.0, 'cash_flows_count': 25, 'period_start': '2008-12-01', 'period_end': '2023-10-01', 'days_in_period': 5417}
2025-10-20 14:11:57,990 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] IRR calculation returned: {'success': True, 'irr_percentage': 7.1, 'irr_decimal': 0.07094878966779472, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1543, 'valuation_amount': 0.0, 'cash_flows_count': 25, 'period_start': '2008-12-01', 'period_end': '2023-10-01', 'days_in_period': 5417}
2025-10-20 14:11:57,991 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Calculated IRR percentage: 7.1%
2025-10-20 14:11:57,991 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Looking for fund valuation with fund_id=1543, date=2025-05-01
2025-10-20 14:11:58,004 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Fund valuation ID: 7213
2025-10-20 14:11:58,011 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Checking for existing IRR record with fund_id=1543, date=2025-05-01
2025-10-20 14:11:58,015 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Found existing IRR record with ID: 7740
2025-10-20 14:11:58,015 - app.services.irr_cascade_service - INFO - ğŸ” [FUND IRR CALC] Updating existing IRR ID 7740 with value 7.1%        
2025-10-20 14:11:58,018 - app.services.irr_cascade_service - INFO - ğŸ“Š âœ… Updated fund IRR for fund 1543 on 2025-05-01: 7.1%
2025-10-20 14:11:58,021 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1543]
2025-10-20 14:11:58,023 - app.services.irr_cascade_service - INFO - ğŸ” [BATCH IRR CALC] âœ… Successfully calculated IRR for fund 1543        
2025-10-20 14:11:58,028 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1536, 1537, 1538,, 1539, 1540, 1541, 1542, 1543]
2025-10-20 14:11:58,031 - app.services.irr_cascade_service - INFO - ğŸ—‘ï¸ Invalidated 0 IRR cache entries for 8 recalculated funds
2025-10-20 14:11:58,033 - app.services.irr_cascade_service - INFO - ğŸ“Š Recalculated 8 fund IRRs for portfolio 316 on 2025-05-01
2025-10-20 14:11:58,043 - app.services.irr_cascade_service - INFO - ğŸ“Š Portfolio 316 completeness for 2025-05-01: 8/8 = True
2025-10-20 14:11:58,066 - app.utils.irr_cache - WARNING - âš ï¸ [CACHE DEBUG] No cache entries found to invalidate for funds [1541, 1542, 1543,, 1540, 1536, 1537, 1539, 1538]
2025-10-20 14:11:58,075 - app.services.irr_cascade_service - WARNING - âš ï¸ Targeted cache invalidation found 0 entries, clearing entire cachee for portfolio 316
2025-10-20 14:11:58,077 - app.services.irr_cascade_service - INFO - ğŸ—‘ï¸ Pre-calculation: Cleared 0 total cache entries to ensure fresh calcullation
2025-10-20 14:11:58,077 - app.api.routes.portfolio_funds - INFO - Calculating aggregated IRR for 8 portfolio funds  (BYPASSING CACHE)       
2025-10-20 14:11:58,078 - app.api.routes.portfolio_funds - INFO - ğŸ”„ Bypassing cache for fresh calculation as requested
2025-10-20 14:11:58,079 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 14:11:58,079 - app.api.routes.portfolio_funds - INFO - ğŸš€ Batch fetching valuations for 8 funds (eliminates 8 individual requests)
2025-10-20 14:11:58,085 - app.api.routes.portfolio_funds - INFO - âœ… Batch valuation optimization complete - Fund valuations: {1536: 0.0, 1537: 0.0, 1538: 0.0, 1539: 0.0, 1540: 0.0, 1541: 0.0, 1542: 0.0, 1543: 0.0}
2025-10-20 14:11:58,095 - app.api.routes.portfolio_funds - INFO - ğŸ“Š Processing 70 activities across 8 funds
2025-10-20 14:11:58,097 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 14:11:58,136 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.004242689361824592
2025-10-20 14:11:58,136 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.050912272341895104
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - Days in period: 5540
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.4243%
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 5.0912%
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - Months in period: 183
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - Array size used: 183
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - ğŸ“Š IRR Calculation Complete: 5.1% over 5540 days (34 cash flow periods)   
2025-10-20 14:11:58,138 - app.api.routes.portfolio_funds - INFO - âœ… Successfully calculated aggregate IRR for 8 portfolio funds: 5.1%      
2025-10-20 14:11:58,142 - app.services.irr_cascade_service - INFO - ğŸ“Š Updated portfolio IRR for portfolio 316 on 2025-05-01: 5.1%
2025-10-20 14:11:58,144 - app.services.irr_cascade_service - INFO - ğŸ”„ [IRR CASCADE] âœ… Batch recalculation completed: {'success': True, 'portfolio_id': 316, 'dates_processed': 10, 'fund_irrs_recalculated': 80, 'portfolio_irrs_recalculated': 10, 'processed_dates': ['2021-03-01', '2021-11-01', '2022-07-01', '2023-04-01', '2023-11-01', '2024-02-01', '2024-07-01', '2025-01-01', '2025-02-01', '2025-05-01'], 'activity_dates': ['2020-07-01'], 'earliest_activity_date': '2020-07-01'}
2025-10-20 14:11:58,144 - app.api.routes.holding_activity_logs - INFO - âœ… [ACTIVITY WRAPPER] Targeted IRR cascade completed successfully: {'success': True, 'portfolio_id': 316, 'dates_processed': 10, 'fund_irrs_recalculated': 80, 'portfolio_irrs_recalculated': 10, 'processed_dates': ['2021-03-01', '2021-11-01', '2022-07-01', '2023-04-01', '2023-11-01', '2024-02-01', '2024-07-01', '2025-01-01', '2025-02-01', '2025-05-01'], 'activity_dates': ['2020-07-01'], 'earliest_activity_date': '2020-07-01'}
2025-10-20 14:11:58,144 - app.api.routes.holding_activity_logs - INFO - Sophisticated IRR recalculation result: {'success': True, 'portfolio_fund_id': 1536, 'portfolio_id': 316, 'activity_start_date': '2020-07-01', 'recalculated_existing': 80, 'new_entries_created': 0, 'portfolio_irr_recalculated': 10, 'dates_processed': 10, 'cascade_service_used': True, 'method': 'targeted_activity_batch'}
INFO:     Waiting for application shutdown.
2025-10-20 14:11:58,252 - main - INFO - Shutting down application...
2025-10-20 14:11:58,253 - database - INFO - Closing PostgreSQL connection pool...
2025-10-20 14:11:58,313 - database - INFO - PostgreSQL connection pool closed successfully
2025-10-20 14:11:58,314 - main - INFO - Database connection pool closed successfully
2025-10-20 14:11:58,314 - main - INFO - Application shutdown completed successfully
INFO:     Application shutdown complete.
INFO:     Finished server process [15880]
2025-10-20 14:11:59,568 - main - INFO - Application startup initiated
2025-10-20 14:11:59,568 - main - INFO - Python version: 3.11.9 (tags/v3.11.9:de54cf5, Apr  2 2024, 10:12:12) [MSC v.1938 64 bit (AMD64)]
2025-10-20 14:11:59,584 - main - INFO - Current working directory: C:\Users\jacob\Documents\kingstons_portal\backend
2025-10-20 14:11:59,584 - main - INFO - Added to Python path: C:\Users\jacob\Documents\kingstons_portal\backend
2025-10-20 14:12:00,817 - main - INFO - All modules imported successfully
2025-10-20 14:12:01,060 - database - INFO - Environment variables loaded
2025-10-20 14:12:01,060 - database - INFO - Database URL present: True
C:\Users\jacob\Documents\kingstons_portal\backend\venv\Lib\site-packages\pydantic\_internal\_config.py:321: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:     Started server process [11952]
INFO:     Waiting for application startup.
2025-10-20 14:12:03,230 - main - INFO - Initializing database connection pool...
2025-10-20 14:12:03,230 - database - INFO - Creating PostgreSQL connection pool...
2025-10-20 14:12:04,064 - database - INFO - PostgreSQL connection pool created successfully (min: 5, max: 20)
2025-10-20 14:12:04,066 - database - INFO - Database connection test successful: 1
2025-10-20 14:12:04,095 - database - INFO - Database verification: 210 client products found
2025-10-20 14:12:04,116 - main - INFO - Database connection pool initialized successfully
2025-10-20 14:12:04,125 - main - INFO - Started periodic presence cleanup task
2025-10-20 14:12:04,138 - main - INFO - Application startup completed successfully
INFO:     Application startup complete.
2025-10-20 14:12:04,148 - app.api.routes.client_products - INFO - Fetching complete product details for product ID: 303
2025-10-20 14:12:04,149 - app.api.routes.auth - INFO - Authentication attempt - Cookie Token: True, Header Token: False, Session: True      
INFO:     ('127.0.0.1', 49698) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
2025-10-20 14:12:04,162 - app.api.routes.client_products - INFO - Found product: Stocks & Shares (ID: 303)
2025-10-20 14:12:04,171 - app.api.routes.auth - INFO - User authenticated via cookie token: 3
INFO:     ('127.0.0.1', 50286) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 61571) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 54616) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 61519) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 52459) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 62483) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 52359) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 50079) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 52125) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 58987) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 55555) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 51365) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 60524) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 57799) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 58321) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 57574) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 49254) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 64054) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 56368) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 63879) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 63150) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 51352) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 57384) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
2025-10-20 14:12:04,743 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: get_complete_portfolio for portfolio 316
2025-10-20 14:12:04,746 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Found 8 portfolio funds:
2025-10-20 14:12:04,748 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 1: ID=1541, AvailableFundID=75, Status=active
2025-10-20 14:12:04,749 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 2: ID=1542, AvailableFundID=11, Status=active
2025-10-20 14:12:04,749 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 3: ID=1543, AvailableFundID=37, Status=active
2025-10-20 14:12:04,749 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 4: ID=1540, AvailableFundID=68, Status=active
2025-10-20 14:12:04,750 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 5: ID=1536, AvailableFundID=5, Status=active
2025-10-20 14:12:04,750 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 6: ID=1537, AvailableFundID=13, Status=active
2025-10-20 14:12:04,751 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 7: ID=1539, AvailableFundID=8, Status=active
2025-10-20 14:12:04,751 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 8: ID=1538, AvailableFundID=67, Status=active
2025-10-20 14:12:04,924 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Final response contains 8 portfolio_funds:
2025-10-20 14:12:04,924 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 1: ID=1541, Name=LF Equity Income , Status=active
2025-10-20 14:12:04,925 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 2: ID=1542, Name=FTF ClearBridge UK Rising Dividends, Status=active
2025-10-20 14:12:04,925 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 3: ID=1543, Name=Historical Funds, Status=active       
2025-10-20 14:12:04,925 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 4: ID=1540, Name=Vanguard LifeStrategy 40% Equity A Acc, Status=active
2025-10-20 14:12:04,925 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 5: ID=1536, Name=Cash, Status=active
2025-10-20 14:12:04,926 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 6: ID=1537, Name=Stewart Investors Worldwide Leaders , Status=active
2025-10-20 14:12:04,926 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 7: ID=1539, Name=BNY Mellon Global Income, Status=active
2025-10-20 14:12:04,926 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 8: ID=1538, Name=Royal London Sustainable World Trust C , Status=active
INFO:     ('127.0.0.1', 63526) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
INFO:     ('127.0.0.1', 52483) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open
2025-10-20 14:12:08,866 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: get_complete_portfolio for portfolio 316
2025-10-20 14:12:08,866 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Found 8 portfolio funds:
2025-10-20 14:12:08,867 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 1: ID=1541, AvailableFundID=75, Status=active
2025-10-20 14:12:08,867 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 2: ID=1542, AvailableFundID=11, Status=active
2025-10-20 14:12:08,867 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 3: ID=1543, AvailableFundID=37, Status=active
2025-10-20 14:12:08,868 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 4: ID=1540, AvailableFundID=68, Status=active
2025-10-20 14:12:08,868 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 5: ID=1536, AvailableFundID=5, Status=active
2025-10-20 14:12:08,869 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 6: ID=1537, AvailableFundID=13, Status=active
2025-10-20 14:12:08,869 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 7: ID=1539, AvailableFundID=8, Status=active
2025-10-20 14:12:08,869 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Fund 8: ID=1538, AvailableFundID=67, Status=active
2025-10-20 14:12:08,918 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Final response contains 8 portfolio_funds:
2025-10-20 14:12:08,921 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 1: ID=1541, Name=LF Equity Income , Status=active      
2025-10-20 14:12:08,921 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 2: ID=1542, Name=FTF ClearBridge UK Rising Dividends, Status=active
2025-10-20 14:12:08,922 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 3: ID=1543, Name=Historical Funds, Status=active       
2025-10-20 14:12:08,922 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 4: ID=1540, Name=Vanguard LifeStrategy 40% Equity A Acc, Status=active
2025-10-20 14:12:08,923 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 5: ID=1536, Name=Cash, Status=active
2025-10-20 14:12:08,923 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 6: ID=1537, Name=Stewart Investors Worldwide Leaders , Status=active
2025-10-20 14:12:08,923 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 7: ID=1539, Name=BNY Mellon Global Income, Status=active
2025-10-20 14:12:08,924 - app.api.routes.portfolios - INFO - ğŸ” DEBUG: Response Fund 8: ID=1538, Name=Royal London Sustainable World Trust C , Status=active
INFO:     ('127.0.0.1', 53692) - "WebSocket /api/ws/presence/irr-calculation%3Aproduct-303" [accepted]
INFO:     connection open

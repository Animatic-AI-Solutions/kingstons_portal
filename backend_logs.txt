2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Applied as WITHDRAWAL (positive): +£120.0
2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: ⚠️  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Aggregated cash flows: 2 flows from 2025-04-01 to 2025-05-01    
2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Total valuation: £0.0
2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Cash flow - 2025-04-01: £-120.0
2025-10-20 10:54:00,381 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Cash flow - 2025-05-01: £120.0
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO -
Monthly cash flows:
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO - Month 0: -120.0
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO - Month 1: 120.0
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO - Calculating IRR using numpy_financial.irr...
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO - Raw monthly IRR calculation result: 0.0
2025-10-20 10:54:00,383 - app.api.routes.portfolio_funds - INFO - Annualized IRR (monthly_irr * 12): 0.0
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - Days in period: 30
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO -
IRR Results:
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - Monthly IRR: 0.0000%
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - Annualized IRR: 0.0000%
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - Months in period: 2
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - Array size used: 2
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Final IRR calculation - Decimal: 0.0, Percentage: 0.0%
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: IRR calculation completed: 0.0% for fund 1399 on 2025-05-01     
2025-10-20 10:54:00,385 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: ✅ IRR calculation completed successfully for fund 1399: {'success': True, 'irr_percentage': 0.0, 'irr_decimal': 0.0, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1399, 'valuation_amount': 0.0, 'cash_flows_count': 2, 'period_start': '2025-04-01', 'period_end': '2025-05-01', 'days_in_period': 30}
2025-10-20 10:54:00,389 - app.services.irr_cascade_service - INFO - 📊 Updated fund IRR for fund 1399 on 2025-05-01: 0.0%
2025-10-20 10:54:00,389 - app.utils.irr_cache - WARNING - ⚠️ [CACHE DEBUG] No cache entries found to invalidate for funds [1399]
2025-10-20 10:54:00,389 - app.api.routes.portfolio_funds - INFO - 🔍 IRR CALC ENTRY: calculate_single_portfolio_fund_irr called for fund 1398, date 2025-05-01  (BYPASSING CACHE)
2025-10-20 10:54:00,391 - app.api.routes.portfolio_funds - INFO - 🔄 Bypassing cache for fresh single fund calculation as requested
2025-10-20 10:54:00,393 - app.api.routes.portfolio_funds - INFO - IRR calculation date: 2025-05-01
2025-10-20 10:54:00,394 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Fund valuation: £0.0
2025-10-20 10:54:00,394 - app.api.routes.portfolio_funds - WARNING - 💰 DEBUG: ⚠️  ZERO VALUATION DETECTED! Fund 1398 has £0 valuation      
2025-10-20 10:54:00,395 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Found 4 activities for fund 1398 up to 2025-05-01 (using end-of-day filter: 2025-05-01 23:59:59.999999)
2025-10-20 10:54:00,395 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity ID 12073 - Type: FundSwitchIn, Amount: £100.00, Timestamp: 2025-01-01 00:00:00+00:00, Parsed Date: 2025-01-01, Month Key: 2025-01-01
2025-10-20 10:54:00,395 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity - Date: 2025-01-01, Type: FundSwitchIn, Amount: £100.0
2025-10-20 10:54:00,396 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Applied as FUND SWITCH IN (negative): -£100.0
2025-10-20 10:54:00,396 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity ID 12074 - Type: FundSwitchOut, Amount: £80.00, Timestamp: 2025-02-01 00:00:00+00:00, Parsed Date: 2025-02-01, Month Key: 2025-02-01
2025-10-20 10:54:00,396 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity - Date: 2025-02-01, Type: FundSwitchOut, Amount: £80.0
2025-10-20 10:54:00,418 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Applied as FUND SWITCH OUT (positive): +£80.0
2025-10-20 10:54:00,419 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity ID 12076 - Type: FundSwitchOut, Amount: £10.00, Timestamp: 2025-03-01 00:00:00+00:00, Parsed Date: 2025-03-01, Month Key: 2025-03-01
2025-10-20 10:54:00,419 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity - Date: 2025-03-01, Type: FundSwitchOut, Amount: £10.0
2025-10-20 10:54:00,419 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Applied as FUND SWITCH OUT (positive): +£10.0
2025-10-20 10:54:00,419 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity ID 12077 - Type: FundSwitchIn, Amount: £10.00, Timestamp: 2025-03-01 00:00:00+00:00, Parsed Date: 2025-03-01, Month Key: 2025-03-01
2025-10-20 10:54:00,419 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Processing activity - Date: 2025-03-01, Type: FundSwitchIn, Amount: £10.0
2025-10-20 10:54:00,425 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Applied as FUND SWITCH IN (negative): -£10.0
2025-10-20 10:54:00,426 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: ⚠️  Total valuation is zero - omitting final valuations from IRRR calculation for fully exited funds
2025-10-20 10:54:00,426 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Aggregated cash flows: 3 flows from 2025-01-01 to 2025-03-01    
2025-10-20 10:54:00,427 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Total valuation: £0.0
2025-10-20 10:54:00,428 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Cash flow - 2025-01-01: £-100.0
2025-10-20 10:54:00,429 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Cash flow - 2025-02-01: £80.0
2025-10-20 10:54:00,431 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Cash flow - 2025-03-01: £0.0
2025-10-20 10:54:00,443 - app.api.routes.portfolio_funds - INFO - Final cash flow is exactly 0.0 - this indicates no net change over the period. Returning IRR of 0%.
2025-10-20 10:54:00,444 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: Final IRR calculation - Decimal: 0.0, Percentage: 0.0%
2025-10-20 10:54:00,444 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: IRR calculation completed: 0.0% for fund 1398 on 2025-05-01     
2025-10-20 10:54:00,445 - app.api.routes.portfolio_funds - INFO - 💰 DEBUG: ✅ IRR calculation completed successfully for fund 1398: {'success': True, 'irr_percentage': 0.0, 'irr_decimal': 0.0, 'calculation_date': '2025-05-01', 'portfolio_fund_id': 1398, 'valuation_amount': 0.0, 'cash_flows_count': 3, 'period_start': '2025-01-01', 'period_end': '2025-03-01', 'days_in_period': 59}
2025-10-20 10:54:00,453 - app.services.irr_cascade_service - INFO - 📊 Updated fund IRR for fund 1398 on 2025-05-01: 0.0%
2025-10-20 10:54:00,456 - app.utils.irr_cache - WARNING - ⚠️ [CACHE DEBUG] No cache entries found to invalidate for funds [1398]
2025-10-20 10:54:00,457 - app.utils.irr_cache - WARNING - ⚠️ [CACHE DEBUG] No cache entries found to invalidate for funds [1399, 1398]      
2025-10-20 10:54:00,457 - app.services.irr_cascade_service - INFO - 🗑️ Invalidated 0 IRR cache entries for 2 recalculated funds
2025-10-20 10:54:00,458 - app.services.irr_cascade_service - INFO - 📊 Recalculated 2 fund IRRs for portfolio 291 on 2025-05-01
2025-10-20 10:54:00,461 - app.services.irr_cascade_service - INFO - 📊 Portfolio 291 completeness for 2025-05-01: 2/2 = True
2025-10-20 10:54:00,463 - app.utils.irr_cache - WARNING - ⚠️ [CACHE DEBUG] No cache entries found to invalidate for funds [1398, 1399]
2025-10-20 10:54:00,465 - app.services.irr_cascade_service - WARNING - ⚠️ Targeted cache invalidation found 0 entries, clearing entire cachee for portfolio 291